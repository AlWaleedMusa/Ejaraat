{% load i18n %}
{% load custome_filters %}


{% comment %} <div>
    <div>
        <h2 class="px-1">{{ property.name }} - {{ property.get_property_type_display }}</h2>
    </div>
    <div class="row row-cols-1 row-cols-md-3">
        {% for item in property.property_rentals.all %}
            <div class="col p-3">

            </div>
        {% endfor %}
    </div>
</div> {% endcomment %}

<div class="property-details-container">
    <!-- Property Details -->
    <div>
        <h2>{{ property.name }} - {{ property.get_property_type_display }}</h2>
        <p class="text-muted"><i class="bi bi-geo-alt-fill pe-1"></i> {{ property.get_country_display }}, {{ property.city }}</p>
        <h4 class="text-success">{{ property.price|format_numbers }} {{ property.currency }}/{% trans "month" %}</h4>
        <hr>
        
        <!-- Tabs for different sections -->
        <ul class="nav nav-tabs" id="propertyDetailsTab" role="tablist">
            {% if property.is_rented %}
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab" aria-controls="overview" aria-selected="true">
                        {% trans "Overview" %}
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="tenant-tab" data-bs-toggle="tab" data-bs-target="#tenant" type="button" role="tab" aria-controls="tenant" aria-selected="false">
                        {% trans "Tenant Info" %}
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link {% if not property.is_rented %}active{% endif %}" id="rental-history-tab" data-bs-toggle="tab" data-bs-target="#rental-history" type="button" role="tab" aria-controls="rental-history" aria-selected="false">
                        {% trans "Rental History" %}
                    </button>
                </li>
            {% else %}
                <li class="nav-item" role="presentation">
                    <button class="nav-link {% if not property.is_rented %}active{% endif %}" id="rental-history-tab" data-bs-toggle="tab" data-bs-target="#rental-history" type="button" role="tab" aria-controls="rental-history" aria-selected="false">
                        {% trans "Rental History" %}
                    </button>
                </li>
            {% endif %}
        </ul>
        
        <div class="tab-content mt-3" id="propertyDetailsTabContent">
        <!-- Overview Tab -->
        <div class="tab-pane fade show {% if property.is_rented %}active{% endif %}" id="overview" role="tabpanel" aria-labelledby="overview-tab">
            <h5 class="pb-2">{% trans "Property Overview" %}</h5>
            
            <!-- Card for Property Overview -->
            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <p><strong>{% trans "Rent start date" %}:</strong> {{ rent_property.start_date|date:"d M Y" }}</p>
                        </div>
                        <div class="col-md-6 mb-3">
                            <p><strong>{% trans "Rent end date" %}:</strong> {{ rent_property.end_date|date:"d M Y" }}</p>
                        </div>
                        <div class="col-md-6 mb-3">
                            <p><strong>{% trans "Damage deposit" %}:</strong> 
                                {% if rent_property.damage_deposit %}
                                    {{ rent_property.damage_deposit|format_numbers }} {{ property.currency }}
                                {% else %}
                                    {% trans "N/A" %}
                                {% endif %}
                            </p>
                        </div>
                        <div class="col-md-6 mb-3">
                            <p><strong>{% trans "Next payment" %}:</strong>
                                {% if rent_property.get_next_payment %}
                                    {% trans "After" %} {{ rent_property.get_next_payment }} {% trans "Days" %}
                                {% else %}
                                    {% trans "N/A" %}
                                {% endif %}
                            </p>
                        </div>
                        <div class="col-md-6 mb-3">
                            <p><strong>{% trans "Expected income" %}:</strong> {{ rent_property.expected_income }} {{ property.currency }}</p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>{% trans "Contract image" %}:</strong>
                                {% if rent_property.contract %}
                                    <a href="{{ rent_property.contract.url }}" target="_blank" class="btn btn-dark btn-sm">{% trans "View contract" %}</a>
                                {% else %}
                                    {% trans "N/A" %}
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tenant Info Tab -->
        <div class="tab-pane fade" id="tenant" role="tabpanel" aria-labelledby="tenant-tab">
            <h5 class="pb-2">{% trans "Current Tenant" %}</h5>
        
            <!-- Card for Tenant Info -->
            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <div class="row">
                        <!-- Tenant Name -->
                        <div class="col-md-6 mb-3">
                            <p>
                                <strong>{% trans "Name" %}:</strong> {{ rent_property.tenant.name }}
                            </p>
                        </div>
        
                        <!-- Tenant ID Image -->
                        <div class="col-md-6 mb-3">
                            <p>
                                <strong>{% trans "ID image" %}:</strong>
                                {% if rent_property.tenant.id_image %}
                                    <a href="{{ rent_property.tenant.id_image.url }}" target="_blank" class="btn btn-dark btn-sm">{% trans "View ID Image" %}</a>
                                {% else %}
                                    {% trans "N/A" %}
                                {% endif %}
                            </p>
                        </div>
                        
                        <!-- Tenant Phone Number with Mobile Buttons -->
                        <div class="col-md-6 mb-3">
                            <p>
                                <strong>{% trans "Phone Number" %}:</strong> {{ rent_property.tenant.phone_number }}
                                <div id="mobile-buttons" class="d-none">
                                    <a href="tel:{{ rent_property.tenant.phone_number }}" class="btn btn-success btn-sm">{% trans "Call" %}</a>
                                    <a href="sms:{{ rent_property.tenant.phone_number }}" class="btn btn-warning btn-sm">{% trans "Text Message" %}</a>
                                </div>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Rental History Tab -->
            <div class="tab-pane {% if not property.is_rented %}active{% endif %}" id="rental-history" role="tabpanel" aria-labelledby="rental-history-tab">
                <h5 class="pb-2">{% trans "Rental History" %}</h5>
                <ul>
                    {% for rental in property.rental_history %}
                        <li><strong>{{ rental.start_date }} - {{ rental.end_date }}:</strong> {{ rental.tenant_name }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
    // Simple check for mobile devices
    if (/Mobi|Android/i.test(navigator.userAgent)) {
        document.getElementById('mobile-buttons').classList.remove('d-none');
    }
</script>
